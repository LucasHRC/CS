<!DOCTYPE html>
<html>
<head>
    <title>Contrôle LED RGB, LED ON/OFF et Température</title>
    <script>
        let connection;

        window.onload = () => {
            const ip = prompt("Entrez l'adresse IP de votre ESP32:", "10.1.224.101");
            connection = new WebSocket('ws://' + ip + ':81/');

            connection.onopen = () => {
                console.log("Connecté au serveur WebSocket");
                document.getElementById("status").innerText = "Connecté";
            };

            connection.onerror = error => {
                console.error("Erreur WebSocket", error);
                document.getElementById("status").innerText = "Erreur de connexion";
            };

            connection.onmessage = event => {
                console.log("Message reçu du serveur:", event.data);

                if (event.data.startsWith("Temperature:")) {
                    const temp = event.data.split(":")[1];
                    document.getElementById("temperature").innerText = temp + " °C";
                }
            };
        };

        function sendColor() {
            const colorInput = document.getElementById("color").value;
            if (connection.readyState === WebSocket.OPEN) {
                if (/^#[0-9A-F]{6}$/i.test(colorInput)) {
                    connection.send(colorInput);
                } else {
                    alert("Veuillez entrer un code couleur valide au format #RRGGBB");
                }
            } else {
                alert("WebSocket non connecté");
            }
        }

        function turnOn() {
            if (connection.readyState === WebSocket.OPEN) {
                connection.send("OFF"); // Envoyer "OFF" pour allumer la LED
            } else {
                alert("WebSocket non connecté");
            }
        }

        function turnOff() {
            if (connection.readyState === WebSocket.OPEN) {
                connection.send("ON"); // Envoyer "ON" pour éteindre la LED
            } else {
                alert("WebSocket non connecté");
            }
        }
    </script>
</head>
<body>
    <h1>Contrôle LED RGB, LED ON/OFF et Température</h1>
    <p id="status">Connexion en cours...</p>

    <h2>Température actuelle</h2>
    <p id="temperature">--- °C</p>

    <h2>Envoyer une couleur à la LED RGB</h2>
    <input type="text" id="color" placeholder="#FF5733">
    <button onclick="sendColor()">Envoyer</button>

    <h2>Contrôle de la LED ON/OFF</h2>
    <button onclick="turnOff()">Éteindre la LED</button> <!-- Inverser les libellés -->
    <button onclick="turnOn()">Allumer la LED</button> <!-- Inverser les libellés -->
</body>
</html>
